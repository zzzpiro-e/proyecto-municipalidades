{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">

    <h2 class="mb-4">
        <i class="bi bi-person-circle me-2"></i> Mi Perfil
    </h2>

    <form method="POST" id="formPerfil">
        {% csrf_token %}

        <div class="card shadow-sm p-4">

            <!-- =========================== -->
            <!-- Información NO editable -->
            <!-- =========================== -->

            <h5 class="mb-3">Información Personal</h5>

            <div class="row mb-3">
                <div class="col">
                    <label class="form-label">Nombre</label>
                    <input type="text" class="form-control" 
                           value="{{ user.first_name }}" readonly>
                </div>

                <div class="col">
                    <label class="form-label">Apellido</label>
                    <input type="text" class="form-control" 
                           value="{{ user.last_name }}" readonly>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">Grupo / Rol</label>
                <input type="text" class="form-control"
                       value="{{ user.profile.group }}" readonly>
            </div>

            <hr class="my-4">

            <!-- =========================== -->
            <!-- Información EDITABLE -->
            <!-- =========================== -->

            <h5 class="mb-3">Contacto</h5>

            <!-- Correo -->
            <div class="mb-3">
                <label class="form-label">Correo</label>
                <div class="input-group">
                    <input id="campoCorreo" name="email" type="email"
                           class="form-control"
                           value="{{ user.email }}" readonly>

                    <span class="input-group-text" id="iconCorreo" style="cursor:pointer;">
                        <i class="bi bi-pencil-square"></i>
                    </span>
                </div>
            </div>

            <!-- Teléfono -->
            <div class="mb-3">
                <label class="form-label">Teléfono</label>
                <div class="input-group">
                    <input id="campoTelefono" name="telefono" type="text"
                           class="form-control"
                           value="{{ user.profile.telefono }}" readonly>

                    <span class="input-group-text" id="iconTelefono" style="cursor:pointer;">
                        <i class="bi bi-pencil-square"></i>
                    </span>
                </div>
            </div>

            <!-- Botones -->
            <div id="acciones" class="mt-3" style="display:none;">
                <button type="submit" class="btn btn-success">Guardar cambios</button>
                <button type="button" class="btn btn-secondary" id="cancelarEdicion">Cancelar</button>
            </div>

            <hr class="my-4">

        </div>
    </form>
    {% if messages %}
<div class="alert alert-success mt-3">
    <ul class="mb-0">
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}
</div>

{% if user.profile.group.id == 1 %}
    <a href="{% url 'main_admin' %}" class="btn btn-outline-secondary mt-3">Volver</a>
{% elif user.profile.group.id == 2 %}
    <a href="{% url 'main_direccion' %}" class="btn btn-outline-secondary mt-3">Volver</a>
{% elif user.profile.group.id == 3 %}
    <a href="{% url 'main_departamento' %}" class="btn btn-outline-secondary mt-3">Volver</a>
{% elif user.profile.group.id == 4 %}
    <a href="{% url 'main_territorial' %}" class="btn btn-outline-secondary mt-3">Volver</a>
{% elif user.profile.group.id == 5 %}
    <a href="{% url 'main_cuadrilla' %}" class="btn btn-outline-secondary mt-3">Volver</a>
{% endif %}


<script>
    // Campos editables
    const campoCorreo = document.getElementById("campoCorreo");
    const campoTelefono = document.getElementById("campoTelefono");
    const acciones = document.getElementById("acciones");

    const iconCorreo = document.getElementById("iconCorreo");
    const iconTelefono = document.getElementById("iconTelefono");
    const cancelar = document.getElementById("cancelarEdicion");

    const valoresOriginales = {
        email: campoCorreo.value,
        telefono: campoTelefono.value
    };

    function activarEdicion(campo) {
        campo.readOnly = false;
        acciones.style.display = "block";
        campo.focus();
    }

    iconCorreo.onclick = () => activarEdicion(campoCorreo);
    iconTelefono.onclick = () => activarEdicion(campoTelefono);

    cancelar.onclick = () => {
        campoCorreo.value = valoresOriginales.email;
        campoTelefono.value = valoresOriginales.telefono;

        campoCorreo.readOnly = true;
        campoTelefono.readOnly = true;

        acciones.style.display = "none";
    };
</script>

{% endblock %}



