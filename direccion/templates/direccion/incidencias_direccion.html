{% extends 'core/base.html' %}
{% load static %}
{% block title %}Incidencias de la Dirección{% endblock %}
{% block content %}

<h4>Incidencias asociadas a la dirección: {{ direccion.nombre_direccion }}</h4>
<hr/>

<div class="col-3 d-flex align-items-center">
        <form method="get" class="d-flex align-items-center">
            <label class="me-2"><strong>Estado:</strong></label>
            <select name="estado" onchange="this.form.submit()" 
                    class="form-select" style="max-width: 250px;">
                <option value="Todos" {% if estado_actual == "Todos" %}selected{% endif %}>Todos</option>
                <option value="Pendiente" {% if estado_actual == "Pendiente" %}selected{% endif %}>Pendiente</option>
                <option value="Asignada" {% if estado_actual == "Asignada" %}selected{% endif %}>Asignada</option>
                <option value="Resuelta" {% if estado_actual == "Resuelta" %}selected{% endif %}>Resuelta</option>
                <option value="Rechazada" {% if estado_actual == "Rechazada" %}selected{% endif %}>Rechazada</option>
            </select>
        </form>
    </div>

<div class="table-responsive">
    <table class="table table-striped table-hover align-middle text-center">
        <thead class="table-dark">
            <tr>
                <th scope="col">Departamento</th>
                <th scope="col">Título</th>
                <th scope="col">Tipo</th>
                <th scope="col">Ubicación</th>
                <th scope="col">Estado</th>
            </tr>
        </thead>
        <tbody>
            {% for inc in incidencias %}
                <tr>
                    <td>{{ inc.departamento.nombre_departamento }}</td>
                    <td>{{ inc.titulo }}</td>
                    <td>{{ inc.tipo }}</td>
                    <td>{{ inc.ubicacion }}</td>
                    <td>{{ inc.estado }}</td>
                </tr>
            {% empty %}
                <tr><td colspan="5">No hay incidencias asociadas a esta dirección.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<nav aria-label="Page navigation" class="mt-3">
    <ul class="pagination justify-content-center">


        {% if incidencias.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ incidencias.previous_page_number }}&estado={{ estado_actual }}">
                    Anterior
                </a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link">Anterior</span>
            </li>
        {% endif %}


        {% for num in incidencias.paginator.page_range %}
            {% if incidencias.number == num %}
                <li class="page-item active">
                    <span class="page-link">{{ num }}</span>
                </li>
            {% else %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ num }}&estado={{ estado_actual }}">{{ num }}</a>
                </li>
            {% endif %}
        {% endfor %}


        {% if incidencias.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ incidencias.next_page_number }}&estado={{ estado_actual }}">
                    Siguiente
                </a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link">Siguiente</span>
            </li>
        {% endif %}

    </ul>
</nav>

<br/>
<a href="{% url 'main_direccion' %}">Volver al menú</a>

{% endblock %}
